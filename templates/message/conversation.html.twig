{% block main %}
<div class="container mt-4 conversation-container">
    <h2 class="mb-4">ðŸ’¬ Conversation avec {{ contact.pseudo ?: contact.username }}</h2>

    <div class="chat-window">
        {% if messages|length > 0 %}
            {% for message in messages %}
                {% set isMine = message.isMine(app.user) %}
                <div class="message-row {{ isMine ? 'sent' : 'received' }}">
                    <div class="avatar">
                        <img src="{{ asset(message.getSenderAvatar()) }}" alt="Avatar">
                    </div>
                    <div class="bubble message-bubble {{ isMine ? 'bg-primary text-white' : 'bg-light' }}">
                        <p class="mb-1">{{ message.content }}</p>
                        <span class="timestamp">{{ message.getFormattedDate() }}</span>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">Aucun message pour le moment.</p>
        {% endif %}
    </div>

    <form method="POST" action="{{ path('conversation_view', {id: conversation.id}) }}" class="message-form mt-4">
        <textarea name="content" rows="1" placeholder="Ã‰cris ton messageâ€¦" required></textarea>
        <button type="submit" class="send-button">Envoyer</button>
    </form>
</div>

<script>
    window.scrollTo(0, document.body.scrollHeight);
    document.querySelector('form')?.addEventListener('submit', () => {
        if (navigator.vibrate) navigator.vibrate(50);
    });
</script>
{% endblock %}
